# 推荐系统基础

**1、推荐系统的转化流程是什么？**

先曝光，后点击，点击以后分为滑动到底+评论，点赞，收藏，转发四种（抖音没有曝光和点击）

**2、推荐系统的短期消费指标？**

点击率、点赞率、收藏率、转发率，点击率是点击次数/曝光次数，后三个是除以点击次数

阅读完成率=滑动到底次数/点击次数×f（归一化函数，与笔记长度有关）

**3、推荐系统的北极星指标（最关键指标）？**

日活/月活用户数（DAU/MAU），人均使用推荐时长，人均阅读笔记数量，发布渗透率（当日发布人数/日活人数）和人均发布量（当日发布笔记数/日活人数）

最核心的指标是DAU和留存（LT7、LT30，代表7天/30天内用户对app的使用率）

北极星指标有利于提升内容多样性，提高用户的活性和数量

**4、推荐系统实验流程分为哪几种？**

离线实验offline（线下，无用户交互）

小流量A/B测试、全流量上线（线上，有用户交互）

**5、推荐系统的链路（重点）**

过程： 召回——>粗排——>精排——>重排

物品数：几亿——>几千——>几百——>几百——>几十

召回：从物品数据库中快速取回一些物品

粗排：用规模较小的机器学习模型对笔记打分，得到几百篇笔记（需要截断）

精排：用大规模神经网络对粗排的几百篇笔记打分，反映用户兴趣（不用截断）

重排：根据精排分数和多样性分数抽样得到几十篇笔记，并把内容打散

链路当中哪个被公司投入的资源最多：精排

**6、A/B测试的分桶方式是什么？**

先用哈希函数把用户ID映射到某个区间内整数，然后采用随机分桶，把n位用户（这些整数）分到b个桶。设置一个桶作为对照组，其它若干桶作为实验组，实验组指标明显优于对照组，将策略推全。

**7、分层实验的目的是什么？两个原则？**

目的是增加同时做的实验数量，解决流量不够用的问题

两个原则：同层互斥（一个桶不受多种实验策略影响），不同层正交（相互独立）

**8、holdout的策略？**

Holdout策略是一种用于衡量一系列实验或整个推荐系统在某个周期内对业务核心指标（如DAU、留存、时长）的**累积贡献**的实验方法。

*   **做法**：取一小部分用户（例如10%）作为**holdout桶**（对照组），他们不应用任何新上线的实验策略。剩余90%的用户作为**实验桶**，正常进行各种A/B测试和新策略迭代。
*   **评估**：通过对比90%实验桶和10% holdout桶的核心指标差异（diff），就可以衡量出整个部门在该周期内所有工作带来的整体业务收益。
*   **周期**：每个考核周期（如一个季度）结束后，会清除holdout桶，将成功的实验策略推全到100%用户。在下一个周期开始时，重新随机划分新的holdout桶，开始新一轮的评估。

**9、反转实验的必要性？实验方式？一个考核周期结束后对反转桶有无影响？**

必要性：有的指标需要长期观测才能获得稳定指标，反转实验既保证了新策略推全，也可以长期观测实验指标。

方式：推全的新层开个旧策略的桶，对比观测新策略和旧策略的diff。

一个考核周期结束后，会清除holdout桶，但只要反转实验没有结束，反转桶就不会受影响，反转结束后才把新策略用到反转桶上，实验得到真正推全。

**10、推荐系统的架构分为哪两方面？**

功能架构和数据架构，功能架构就是推荐系统链路中的四个过程（召回，粗排，精排，重拍），数据架构运用Lambda架构，包含离线层、近线层、在线层。

- 离线层 (Batch Layer)：处理冷数据（如存储在 HDFS 上的历史日志）。它通过定时（如每小时或每天）的批量计算任务（使用 Spark、Hadoop 等），来训练复杂的模型、生成用户和物品的画像（Features）。这一层计算量大，但对实时性要求不高。

- 在线层 (Speed/Streaming Layer)：处理热数据（如用户当前的实时行为流）。它通过流式计算框架（如 Flink、Storm）对最新数据进行快速处理，以弥补离线层计算的延迟，生成实时特征。这一层计算快，保证了数据的时效性。

- 近线/服务层 (Serving Layer)：这一层是离线层和在线层的“桥梁”和“出口”。它将离线批量计算的结果和在线流式计算的结果整合起来，存储在高速的键值数据库（如 Redis、Cassandra）中，以便功能架构中的各个模块（特别是精排）能够快速查询和获取特征，进行在线预测。

**11、冷数据和热数据的含义？**

冷数据：已经存储在Hadoop分布式文件系统（HDFS）的数据日志

热数据：没来得及生成用户日志的数据，或没来得及落盘在HDFS上的数据

**12、Lambda架构如何处理数据？**

离线层：冷数据在该层进行定时批量计算，每小时统计每个视频的曝光数、点击数并保存结果，一周的CTR就是这168（24x7）个中间结果的汇总，采用Hadoop、Spark、Flink等大数据框架完成。

近线层：离线层计算完毕后视频CTR还在HDFS上，HDFS不利于快速读写，因此将离线批量计算的结果导入Cassandra、Redis这种键值型数据库，缓存离线层结果，便于快速读取。

在线层：离线层中的统计存在时间缺口（例如1-2小时），因此需要让热数据在该层进行流式更新，弥补时间缺口下的数据，计算结果也缓存在Redis中。该层采用Storm、Flink等流式计算框架。

**13、推广搜的作用？有哪些相同点？**

推荐和搜索：负责留住用户，生产流量；广告：负责将流量变现。

相同点：功能架构上都遵循召回粗筛，排序模块精挑细选；数据架构都遵循Lambda结构，算法上三者很多都通用，且都需要很强的个性化。

**14、推荐和搜索的区别？**

第一个区别：用户表达意图的方式不同，搜索依赖输入的查询语句显示表达意图，推荐无需用户显示表达意图，而是通过系统长期观察猜测用户意图。

第二个区别：搜索对结果准确性更加严格，搜索的结果是交集，推荐的结果是并集。

**15、推搜和广告的区别?**

广告对用户的行为考察更多：点击、下载、注册、成功下单等，行为链比推搜更深，且广告和利益相关，因此对预测的精度有绝对准确性的要求。